<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Browser STT Captions</title>
  <style>
    body {
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 50px;
    }
    #captions {
      margin-top: 20px;
      font-size: 1.6em;
      background: rgba(0, 0, 0, 0.8);
      padding: 12px;
      border-radius: 8px;
      min-height: 60px;
    }
  </style>
</head>
<body>
  <h1>Live Captions (Browser WASM)</h1>
  <button id="startBtn">Start Captions</button>
  <div id="captions">Waiting to start...</div>

  <script type="module">
    import { VoskRecognizer } from "./vosk‑wasm/vosk.js";  
    // Adjust the path based on where the WASM model files are

    const startBtn = document.getElementById("startBtn");
    const captionsDiv = document.getElementById("captions");

    let recognizer;

    startBtn.addEventListener("click", async () => {
      startBtn.disabled = true;
      captionsDiv.innerText = "Initializing...";

      // Load WASM model
      recognizer = await VoskRecognizer.create({
        modelPath: "./wasm_model", // Path to your wasm model folder
        sampleRate: 16000
      });

      captionsDiv.innerText = "Model loaded — allow mic";

      // Ask for microphone access
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      const audioContext = new AudioContext();
      const source = audioContext.createMediaStreamSource(stream);
      const processor = audioContext.createScriptProcessor(4096, 1, 1);

      source.connect(processor);
      processor.connect(audioContext.destination);

      captionsDiv.innerText = "Captions started — speak now!";

      processor.onaudioprocess = (e) => {
        const input = e.inputBuffer.getChannelData(0);
        // Send audio samples to recognizer (16 kHz utility)
        recognizer.acceptAudio(input);
        const text = recognizer.getFinalResult() || recognizer.getPartialResult();
        if (text) captionsDiv.innerText = text;
      };
    });
  </script>
</body>
</html>
